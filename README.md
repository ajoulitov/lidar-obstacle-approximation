# LiDAR Obstacle Approximation

[Гайд по уствановке](SETUP.md)

[Итоги работы](CONTRIBUTIONS.md)

## Описание проекта

Алгоритм, который по точкам 2D LiDAR строит аппроксимацию препятствий в виде набора отрезков и кругов (основано на этой [статье](https://github.com/tysik/obstacle_detector/blob/master/resources/ObstacleDetector.pdf)). Сам алгоритм был чуть доработан: изменена логика аппроксимации фиксированного набора точек отрезком (усреднение + МНК), а также слияние кластеров реализовано через структуру данным _Система непересекающихся множеств_, что значительно ускорило алгоритм. 

Алгоритм реализован как Python пакет, а также есть версия в виде ROS пакета, запускаемая в Docker.

Пользователь в симуляции запускает сцену с роботом и 2D LiDAR (для примера взят симулятор [Webots](https://cyberbotics.com/)), запускает наш ROS-пакет, и видны: исходный скан лидара и аппроксимированные препятствия в виде отрезков и кругов.

Также возможно использовать обычный контроллер Webots, который вызывает алгоритм аппроксимации препятствий и рисует результат, но работает без ROS пакетов и Docker.


## Схема взаимодействия

<img src="./interaction_scheme.svg" alt="Диаграмма архитектуры" >

## Принцип работы алгоритма
Блок с алгоритмом представляет из себя независимый пакет, который может отдельно и включает в себя блоки __algo__ и __geom_core__ с алгоритмом и основными геометрическими примитивами.

### geom_core:
Подпакет geom_core в себя:
+ Классы для основных примитивов с необходимыми метоадми:
    + Точки
    + Отрезки
    + Окружности
    + Прямые 
    + Прямоугольники
+ Прочие функции необходимые для работы алгоритма 
    + Сортировка по полуряному углу набора точек
    + Различные расстояние между точками/отрезками
    + Прочие функции применяющиеся в алгоритме

### algo:
Подпакет algo содержит реализацию описанного в статье алгоритма, позволяет получать аппроксимацию набора точек с помощью отрезком или отрезков+окружностей.

Алгоритм описанный в статье можно разделить на несколько последовательных этапов.
+ Кластеризация наборов точек
+ Слияние и разделение кластеров точек
+ Аппроксимация кластеов отрезками
+ Слияние отрезков
+ Аппроксимация кластеров точек окружностями по их отрезкам
+ Слияние окружностей

Часть логики некоторых этапов вынесена в общий класс **Cluster**, чтобы сохранять в себе полученные раннее отрезки и иметь рядом с кластером точек приписанную к нему аппроксимирующий его отрезок и, возможно, окружность. Все подобные объекты создаются лениво, по необходимости, потому что построение отрезка или прямой, апроксимирующей набор точек затратно, так как для этого используется SVD-разложение. 

Также отдельно реализована структура данных СНМ, которая служит для оптимизации перебора пар сливаемых отрезков (ранеее слитые отрезки не имеет смысла пытаться сливать). 

Почти все этапы используют какие-то гиперпараметры для того, чтобы совершить то или иное действие, мы используем значения из оригинальной статьи. Сложность алгоритма полиномиальна от количества точек, но также зависит от количества кластеров, которое регулируется параметром d_split, так что для высокой частоты обновления стоит пользоваться 360/720 точками.

## Оригинальная статья
+ Przybyła, M. Online Detection and Tracking of 2D Geometric Obstacles from LRF Data. Poznań University of Technology, 2017. https://github.com/tysik/obstacle_detector/